# chat.tt 域名的服务器配置
server {
    listen                       80;
    server_name                  chat.tt;
    
    # 80 端口自动重定向到 443 端口
    return 301                   https://$host$request_uri;
}

server {
    listen 443                   ssl;
    server_name                  chat.tt;

    ssl_certificate              /chatgpt-web/nginx/cert/chat.tt.pem;
    ssl_certificate_key          /chatgpt-web/nginx/cert/chat.tt.key;
    
    # 设置客户端最大允许的请求大小
    client_max_body_size         100M;

    # 前端资源默认访问 /chatgpt-web/dist 目录
    location / {
        root                     /chatgpt-web/dist;
        try_files                $uri $uri/ /index.html;
    }

    # 静态资源缓存设置
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        root                     /chatgpt-web/dist;
        expires                  7d;
        add_header               Cache-Control "public, no-transform";
    }

    # 将 /api 代理到本地 3002 端口
    location /api {
        proxy_pass               http://localhost:3002;
        proxy_http_version       1.1;
        proxy_set_header         Upgrade $http_upgrade;
        proxy_set_header         Connection "upgrade";
        proxy_set_header         Host $host;
        proxy_set_header         X-Real-IP $remote_addr;
        proxy_set_header         X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header         X-Forwarded-Proto $scheme;
    }
}
